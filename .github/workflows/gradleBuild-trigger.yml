name: Gradle Build Projects

on:
  pull_request:
    branches: [dev, main]
    paths-ignore:
      - '**.gradle/wrapper'
      - '**.gitignore'
      - 'LICENSE'
      - 'THIRD PARTY NOTICES'
      - '**.md'
    workflow_dispatch:

jobs:
  checkPaths:
    runs-on: ubuntu-latest
    outputs:
      abstractions: ${{ steps.filter.outputs.abstractions }}
    steps: 
    - uses: dorny/paths-filter@v2
      id: filter
      with:
        filters: |
          abstractions:
            - 'components/abstractions/**'
          authentication-azure:
            - 'components/authentication/azure/**'
          http-okHttp:
            - 'components/http/okHttp/**'
          serialization-json:
            - 'components/serialization/json/**'
          serialization-text:
            - 'components/serialization/text/**'    
    - run: echo ${{ steps.filter.outputs.abstractions_count }}      
  
  buildAbstractions:
    needs: checkPaths
    if: ${{ needs.checkPaths.outputs.abstractions_count }} > 0
    uses: ./.github/workflows/gradleBuild-component.yml
    with:
      componentName: abstractions
      componentPath: ./components/abstractions/

  buildAuthentication:
    needs: checkPaths
    if: ${{ needs.checkPaths.outputs.authentication-azure_count }} > 0
    uses: ./.github/workflows/gradleBuild-component.yml
    with:
      componentName: authentication-azure
      componentPath: ./components/authentication/azure/

  buildOkHttp:
    needs: checkPaths
    if: ${{ needs.checkPaths.outputs.http-okHttp_count }} > 0
    uses: ./.github/workflows/gradleBuild-component.yml
    with:
      componentName: http-okHttp 
      componentPath: ./components/http/okHttp/

  buildSerializationJson:
    needs: checkPaths
    if: ${{ needs.checkPaths.outputs.serialization-json_count }} > 0
    uses: ./.github/workflows/gradleBuild-component.yml
    with:
      componentName: serialization-json
      componentPath: ./components/serialization/json/

  buildSerializationText:
    needs: checkPaths
    if: ${{ needs.checkPaths.outputs.serialization-text_count }} > 0 #these condtions need to be fixed
    uses: ./.github/workflows/gradleBuild-component.yml
    with:
      componentName: serialization-text
      componentPath: ./components/serialization/text/